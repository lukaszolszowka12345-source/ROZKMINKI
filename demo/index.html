<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover"/>
  <title>ROZKMINKI — DEMO</title>

  <meta name="color-scheme" content="dark"/>

  <link rel="preconnect" href="https://fonts.googleapis.com"/>
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"/>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&family=Playfair+Display:wght@600;700;800&display=swap" rel="stylesheet"/>
  <link href="../assets/theme.css" rel="stylesheet"/>
</head>

<body>
  <div class="wrap">
    <div class="topbar">
      <div>
        <div class="brand">ROZKMINKI</div>
        <div class="tag">DEMO • 10 kategorii (po 1 pytaniu)</div>
      </div>
      <div class="topActions">
        <button class="btn btnGhost btnInfo" id="howtoBtn" type="button">Instrukcja</button>
        <button class="btn btnGold" id="premiumTop" type="button">PREMIUM</button>
      </div>
    </div>

    <div class="card" id="screenSetup">
      <h1>Demo gry</h1>
      <div class="mut">
        Przedsmak pełnej wersji — po jednym pytaniu na kategorię. W Premium masz pełną pulę pytań.
      </div>

      <div class="grid">
        <div>
          <label>Liczba graczy (2–20)</label>

          <div class="row" style="align-items:center; gap:10px">
            <button class="btn btnGhost" id="pMinus" type="button" style="width:52px;padding:12px 0">−</button>
            <div class="pill" id="pValue" style="min-width:86px;justify-content:center;font-weight:900">2</div>
            <button class="btn btnGhost" id="pPlus" type="button" style="width:52px;padding:12px 0">+</button>

            <!-- trzymamy wartość, bo logika opiera się na playerCount -->
            <input id="playerCount" type="hidden" value="2" />
          </div>

          <div class="small" style="margin-top:6px">Zakres: 2–20</div>
        </div>

        <div id="playersBox"></div>

        <div>
          <label>Wybierz kategorie (DEMO)</label>
          <div class="row" id="catsBox"></div>
        </div>

        <div class="row">
          <button class="btn btnGhost btnWide" id="startBtn" type="button">Zagraj w DEMO</button>
        </div>

        <div class="two">
          <button class="btn btnGold btnWide" id="premiumBottom1" type="button">Premium — pełna wersja</button>
          <button class="btn btnGold btnWide" id="premiumBottom2" type="button">Premium — kup dostęp</button>
        </div>

        <div class="small">
          W DEMO pytania nie powtarzają się w tej grze — ale pula jest krótka.
        </div>
      </div>
    </div>

    <div class="card hide" id="screenGame">
      <div class="row rowBetween">
        <div class="pill" id="turnPill">Tura</div>
        <div class="row">
          <button class="btn btnGhost" id="copyBtn" type="button">Kopiuj pytanie</button>
          <button class="btn btnGold" id="premiumInGame" type="button">PREMIUM</button>
        </div>
      </div>

      <div style="height:10px"></div>
      <div class="pill" id="metaPill">Info</div>
      <div style="height:10px"></div>

      <div class="bigQ" id="qBox">...</div>

      <div style="height:12px"></div>
      <div class="two">
        <button class="btn btnGhost btnWide" id="nextBtn" type="button">Losuj</button>
        <button class="btn btnGhost btnWide" id="skipBtn" type="button">Inne pytanie (2)</button>
      </div>

      <div style="height:10px"></div>
      <div class="small" id="stateInfo"></div>
      <div class="small warn" id="warnInfo"></div>
    </div>
  </div>

  <script>
    const PREMIUM_PRODUCT_URL = "https://rozkminki.online/products/rozkminki-premium";

    // DEMO: 10 kategorii, po 1 pytaniu
    const QUESTIONS = {
      "Relacje": [
        "Co w relacji jest dla Ciebie ważniejsze: spokój czy prawda – i dlaczego?"
      ],
      "Emocje": [
        "Jaka emocja najczęściej udaje u Ciebie „zmęczenie”?"
      ],
      "Ja (self)": [
        "Gdybyś miał/miała opisać siebie jednym zdaniem bez ról (mąż/żona, praca), co by to było?"
      ],
      "Rozwój": [
        "Jaka jedna rzecz, robiona codziennie przez 10 minut, zmieniłaby Twoje życie?"
      ],
      "Rodzina": [
        "Co w Twojej rodzinie było tematem tabu i jak to na Ciebie wpłynęło?"
      ],
      "Intymność i seks": [
        "Co dla Ciebie oznacza intymność poza samym seksem?"
      ],
      "Praca i pieniądze": [
        "Co oznacza dla Ciebie bezpieczeństwo finansowe w konkretach (liczby/warunki)?"
      ],
      "Zdrowie i ciało": [
        "Jakie sygnały z ciała ignorujesz najczęściej?"
      ],
      "Sens i marzenia": [
        "Gdybyś miał/miała opisać swoje życie jako rozdział książki, jaki ma tytuł dziś?"
      ],
      "Zabawa i ciekawość": [
        "Jaki był Twój ostatni moment czystej frajdy – bez celu?"
      ]
    };

    const CAT_ORDER = Object.keys(QUESTIONS);

    // elements
    const setup = document.getElementById("screenSetup");
    const game = document.getElementById("screenGame");

    const playerCountEl = document.getElementById("playerCount");
    const playersBox = document.getElementById("playersBox");
    const catsBox = document.getElementById("catsBox");
    const startBtn = document.getElementById("startBtn");

    const turnPill = document.getElementById("turnPill");
    const metaPill = document.getElementById("metaPill");
    const qBox = document.getElementById("qBox");
    const nextBtn = document.getElementById("nextBtn");
    const skipBtn = document.getElementById("skipBtn");
    const copyBtn = document.getElementById("copyBtn");
    const stateInfo = document.getElementById("stateInfo");
    const warnInfo = document.getElementById("warnInfo");

    // +/− elements (FIX)
    const pMinus = document.getElementById("pMinus");
    const pPlus  = document.getElementById("pPlus");
    const pValue = document.getElementById("pValue");

    // Premium buttons -> product page (bez crasha gdyby czegoś brakowało)
    [
      document.getElementById("premiumTop"),
      document.getElementById("premiumBottom1"),
      document.getElementById("premiumBottom2"),
      document.getElementById("premiumInGame"),
    ].filter(Boolean).forEach(b => b.addEventListener("click", () => window.location.assign(PREMIUM_PRODUCT_URL)));

    // state
    let players = [];
    let enabledCats = new Set();
    let deck = [];
    let used = new Set();
    let askerIdx = 0;
    let answererIdx = 1;
    let currentQ = null;
    let skipsLeft = {};

    function clamp(n, a, b){ return Math.max(a, Math.min(b, n)); }

    function renderPlayers(){
      const n = clamp(parseInt(playerCountEl.value || "2", 10), 2, 20);
      playerCountEl.value = n;

      // FIX: aktualizuj widoczny licznik
      if (pValue) pValue.textContent = String(n);

      playersBox.innerHTML = "";
      for(let i=0;i<n;i++){
        const inp = document.createElement("input");
        inp.placeholder = `Imię gracza ${i+1}`;
        inp.id = `p_${i}`;
        inp.autocomplete = "off";
        inp.style.marginTop = "8px";
        playersBox.appendChild(inp);
      }
    }

    function renderCats(){
      catsBox.innerHTML = "";
      enabledCats = new Set();

      CAT_ORDER.forEach(cat=>{
        const wrap = document.createElement("label");
        wrap.className = "pill";
        wrap.style.cursor = "pointer";

        const cb = document.createElement("input");
        cb.type = "checkbox";
        cb.checked = true;
        cb.style.width = "auto";
        cb.style.margin = "0";
        cb.addEventListener("change", ()=>{
          if(cb.checked) enabledCats.add(cat);
          else enabledCats.delete(cat);
        });

        enabledCats.add(cat);

        const span = document.createElement("span");
        span.textContent = cat;

        wrap.appendChild(cb);
        wrap.appendChild(span);
        catsBox.appendChild(wrap);
      });
    }

    function buildDeck(){
      deck = [];
      enabledCats.forEach(cat=>{
        (QUESTIONS[cat] || []).forEach((q, idx)=>{
          deck.push({cat, q, key:`${cat}::${idx}`});
        });
      });

      // shuffle
      for(let i=deck.length-1;i>0;i--){
        const j = Math.floor(Math.random()*(i+1));
        [deck[i], deck[j]] = [deck[j], deck[i]];
      }
    }

    function pickNextQuestion(){
      warnInfo.textContent = "";
      while(deck.length){
        const item = deck.pop();
        if(!used.has(item.key)){
          used.add(item.key);
          return item;
        }
      }
      return null;
    }

    function setTurnPills(){
      const asker = players[askerIdx] || `Gracz ${askerIdx+1}`;
      const ans = players[answererIdx] || `Gracz ${answererIdx+1}`;
      turnPill.textContent = `${asker} → pyta`;
      metaPill.textContent = `${ans} → odpowiada • pominięcia: ${skipsLeft[ans] ?? 0}`;
    }

    function showQuestion(item){
      setTurnPills();
      qBox.textContent = item.q;
      stateI
